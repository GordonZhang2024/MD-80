<?xml version="1.0"?>

<!-- McDonnell Douglas MD-80 Instrumentation -->
<!-- Copyright (c) 2021 Josh Davidson (Octal450) -->

<!--
Linear Actuators are commented out because they are broken in current 2020.3. 
Once FGFS ver with them fixed is out on stable, we will enable and enforce that ver
-->

<system name="MD-80: Instrumentation">
	
	<!-- So they start at the right place -->
	<property value="100">/instrumentation/airspeed-indicator[0]/bug-kts-input</property>
	<property value="340">/instrumentation/airspeed-indicator[0]/vmo-mmo-input</property>
	<property value="100">/instrumentation/airspeed-indicator[1]/bug-kts-input</property>
	<property value="340">/instrumentation/airspeed-indicator[1]/vmo-mmo-input</property>
	<property value="1.95">/controls/tri/limit-active</property>
	<property value="15">/controls/tri/rat</property>
	
	<channel name="Airspeed Indicators" execrate="2">
		
		<fcs_function name="/it-autoflight/input/mach-kts-equiv">
			<function>
				<product>
					<quotient>
						<property>/instrumentation/airspeed-indicator/indicated-speed-kt</property>
						<property>/instrumentation/airspeed-indicator/indicated-mach</property>
					</quotient>
					<property>/it-autoflight/input/mach</property>
				</product>
			</function>
		</fcs_function>
		
		<!-- Airspeed Indicator 1 -->
		<switch name="/instrumentation/airspeed-indicator[0]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/emer-ac ge 112
			</test>
		</switch>
		
		<switch name="/instrumentation/airspeed-indicator[0]/speed-kt-input">
			<default value="/instrumentation/airspeed-indicator[0]/speed-kt-input"/>
			<test value="/instrumentation/airspeed-indicator/indicated-speed-kt">
				/instrumentation/airspeed-indicator[0]/power-avail eq 1
			</test>
		</switch>
		
		<actuator name="/instrumentation/airspeed-indicator[0]/speed-kt-actuator">
			<input>/instrumentation/airspeed-indicator[0]/speed-kt-input</input>
			<rate_limit>100</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/airspeed-indicator[0]/speed-kt">
			<input>/instrumentation/airspeed-indicator[0]/speed-kt-actuator</input>
			<c1>20</c1>
		</lag_filter>
		
		<switch name="/instrumentation/airspeed-indicator[0]/mach-input">
			<default value="/instrumentation/airspeed-indicator[0]/mach-input"/>
			<test value="/instrumentation/airspeed-indicator/indicated-mach">
				/instrumentation/airspeed-indicator[0]/power-avail eq 1
			</test>
		</switch>
		
		<fcs_function name="/instrumentation/airspeed-indicator[0]/mach-digit-input">
			<function>
				<sum>
					<product>
						<property>/instrumentation/airspeed-indicator[0]/mach-input</property>
						<value>1000</value>
					</product>
					<value>0.5</value>
				</sum>
			</function>
			<clipto>
				<min>149</min>
				<max>999</max>
			</clipto>
		</fcs_function>
		
		<fcs_function name="/instrumentation/airspeed-indicator[0]/mach-digit-d100">
			<function>
				<integer>
					<quotient>
						<property>/instrumentation/airspeed-indicator[0]/mach-digit-input</property>
						<value>100</value>
					</quotient>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="/instrumentation/airspeed-indicator[0]/mach-digit-d10">
			<function>
				<integer>
					<product>
						<fraction>
							<quotient>
								<property>/instrumentation/airspeed-indicator[0]/mach-digit-input</property>
								<value>100</value>
							</quotient>
						</fraction>
						<value>10</value>
					</product>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="/instrumentation/airspeed-indicator[0]/mach-digit-d1">
			<function>
				<integer>
					<product>
						<fraction>
							<quotient>
								<property>/instrumentation/airspeed-indicator[0]/mach-digit-input</property>
								<value>10</value>
							</quotient>
						</fraction>
						<value>10</value>
					</product>
				</integer>
			</function>
		</fcs_function>
		
		<switch name="/instrumentation/airspeed-indicator[0]/vmo-mmo-input">
			<default value="/instrumentation/airspeed-indicator[0]/vmo-mmo-input"/>
			<test value="dfgs/speeds/vmo-mmo">
				/instrumentation/airspeed-indicator[0]/power-avail eq 1
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/airspeed-indicator[0]/vmo-mmo">
			<input>/instrumentation/airspeed-indicator[0]/vmo-mmo-input</input>
			<c1>20</c1>
		</lag_filter>
		
		<switch name="/instrumentation/airspeed-indicator[0]/bug-kts-input">
			<default value="/instrumentation/airspeed-indicator[0]/bug-kts-input"/>
			<test logic="AND" value="/it-autoflight/input/mach-kts-equiv">
				/instrumentation/airspeed-indicator[0]/power-avail eq 1
				/it-autoflight/input/kts-mach eq 1
			</test>
			<test value="/it-autoflight/input/kts">
				/instrumentation/airspeed-indicator[0]/power-avail eq 1
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/airspeed-indicator[0]/bug-kts">
			<input>/instrumentation/airspeed-indicator[0]/bug-kts-input</input>
			<c1>20</c1>
		</lag_filter>
		
		<!-- Airspeed Indicator 2 -->
		<switch name="/instrumentation/airspeed-indicator[1]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/ac-r ge 112
			</test>
		</switch>
		
		<switch name="/instrumentation/airspeed-indicator[1]/speed-kt-input">
			<default value="/instrumentation/airspeed-indicator[1]/speed-kt-input"/>
			<test value="/instrumentation/airspeed-indicator/indicated-speed-kt">
				/instrumentation/airspeed-indicator[1]/power-avail eq 1
			</test>
		</switch>
		
		<actuator name="/instrumentation/airspeed-indicator[1]/speed-kt-actuator">
			<input>/instrumentation/airspeed-indicator[1]/speed-kt-input</input>
			<rate_limit>100</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/airspeed-indicator[1]/speed-kt">
			<input>/instrumentation/airspeed-indicator[1]/speed-kt-actuator</input>
			<c1>20</c1>
		</lag_filter>
		
		<switch name="/instrumentation/airspeed-indicator[1]/mach-input">
			<default value="/instrumentation/airspeed-indicator[1]/mach-input"/>
			<test value="/instrumentation/airspeed-indicator/indicated-mach">
				/instrumentation/airspeed-indicator[1]/power-avail eq 1
			</test>
		</switch>
		
		<fcs_function name="/instrumentation/airspeed-indicator[1]/mach-digit-input">
			<function>
				<sum>
					<product>
						<property>/instrumentation/airspeed-indicator[1]/mach-input</property>
						<value>1000</value>
					</product>
					<value>0.5</value>
				</sum>
			</function>
			<clipto>
				<min>149</min>
				<max>999</max>
			</clipto>
		</fcs_function>
		
		<fcs_function name="/instrumentation/airspeed-indicator[1]/mach-digit-d100">
			<function>
				<integer>
					<quotient>
						<property>/instrumentation/airspeed-indicator[1]/mach-digit-input</property>
						<value>100</value>
					</quotient>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="/instrumentation/airspeed-indicator[1]/mach-digit-d10">
			<function>
				<integer>
					<product>
						<fraction>
							<quotient>
								<property>/instrumentation/airspeed-indicator[1]/mach-digit-input</property>
								<value>100</value>
							</quotient>
						</fraction>
						<value>10</value>
					</product>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="/instrumentation/airspeed-indicator[1]/mach-digit-d1">
			<function>
				<integer>
					<product>
						<fraction>
							<quotient>
								<property>/instrumentation/airspeed-indicator[1]/mach-digit-input</property>
								<value>10</value>
							</quotient>
						</fraction>
						<value>10</value>
					</product>
				</integer>
			</function>
		</fcs_function>
		
		<switch name="/instrumentation/airspeed-indicator[1]/vmo-mmo-input">
			<default value="/instrumentation/airspeed-indicator[1]/vmo-mmo-input"/>
			<test value="dfgs/speeds/vmo-mmo">
				/instrumentation/airspeed-indicator[1]/power-avail eq 1
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/airspeed-indicator[1]/vmo-mmo">
			<input>/instrumentation/airspeed-indicator[1]/vmo-mmo-input</input>
			<c1>20</c1>
		</lag_filter>
		
		<switch name="/instrumentation/airspeed-indicator[1]/bug-kts-input">
			<default value="/instrumentation/airspeed-indicator[1]/bug-kts-input"/>
			<test logic="AND" value="/it-autoflight/input/mach-kts-equiv">
				/instrumentation/airspeed-indicator[1]/power-avail eq 1
				/it-autoflight/input/kts-mach eq 1
			</test>
			<test value="/it-autoflight/input/kts">
				/instrumentation/airspeed-indicator[1]/power-avail eq 1
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/airspeed-indicator[1]/bug-kts">
			<input>/instrumentation/airspeed-indicator[1]/bug-kts-input</input>
			<c1>20</c1>
		</lag_filter>
	
	</channel>
	
	<channel name="Attitude Indicators" execrate="2">
		
		<!-- Attitude Indicator 1 -->
		<switch name="/instrumentation/ai[0]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/emer-ac ge 112
			</test>
		</switch>
		
		<actuator name="/instrumentation/ai[0]/power-pos">
			<input>/instrumentation/ai[0]/power-avail</input>
			<rate_limit>5</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/ai[0]/power">
			<input>/instrumentation/ai[0]/power-pos</input>
			<c1>2</c1>
		</lag_filter>
		
		<fcs_function name="/instrumentation/ai[0]/pitch-deg">
			<function>
				<product>
					<property>/instrumentation/ai[0]/power</property>
					<property>/orientation/pitch-deg</property>
				</product>
			</function>
			<clipto>
				<min>-90</min>
				<max>90</max>
			</clipto>
		</fcs_function>
		
		<fcs_function name="/instrumentation/ai[0]/roll-deg">
			<function>
				<product>
					<property>/instrumentation/ai[0]/power</property>
					<property>/orientation/roll-deg</property>
				</product>
			</function>
			<clipto>
				<min>-180</min>
				<max>180</max>
			</clipto>
		</fcs_function>
		
		<switch name="/instrumentation/ai[0]/loc-deviation-cmd">
			<default value="0"/>
			<test logic="AND" value="/instrumentation/nav[0]/heading-needle-deflection">
				/instrumentation/ai[0]/power-avail eq 1
				/systems/electrical/outputs/nav[0] ge 24
				/instrumentation/nav[0]/in-range eq 1
				/instrumentation/nav[0]/signal-quality-norm gt 0.99
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/ai[0]/loc-deviation">
			<input>/instrumentation/ai[0]/loc-deviation-cmd</input>
			<c1>10</c1>
		</lag_filter>
		
		<switch name="/instrumentation/ai[0]/gs-deviation-cmd">
			<default value="0"/>
			<test logic="AND" value="/instrumentation/nav[0]/gs-needle-deflection">
				/instrumentation/ai[0]/power-avail eq 1
				/systems/electrical/outputs/nav[0] ge 24
				/instrumentation/nav[0]/gs-in-range eq 1
				/instrumentation/nav[0]/has-gs eq 1
				/instrumentation/nav[0]/signal-quality-norm gt 0.99
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/ai[0]/gs-deviation">
			<input>/instrumentation/ai[0]/gs-deviation-cmd</input>
			<c1>10</c1>
		</lag_filter>
		
		<pure_gain name="/instrumentation/ai[0]/slip-skid-Ny">
			<input>accelerations/Ny</input>
			<gain>-25</gain>
		</pure_gain>
		
		<switch name="/instrumentation/ai[0]/slip-skid-cmd">
			<default value="/fdm/jsbsim/aero/beta-deg"/>
			<test value="0">
				/instrumentation/ai[0]/power-avail ne 1
			</test>
			<test value="/instrumentation/ai[0]/slip-skid-Ny">
				position/wow eq 1
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/ai[0]/slip-skid">
			<input>/instrumentation/ai[0]/slip-skid-cmd</input>
			<c1>5.0</c1>
		</lag_filter>
		
		<!-- Attitude Indicator 2 -->
		<switch name="/instrumentation/ai[1]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/ac-r ge 112
			</test>
		</switch>
		
		<actuator name="/instrumentation/ai[1]/power-pos">
			<input>/instrumentation/ai[1]/power-avail</input>
			<rate_limit>2</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/ai[1]/power">
			<input>/instrumentation/ai[1]/power-pos</input>
			<c1>5</c1>
		</lag_filter>
		
		<fcs_function name="/instrumentation/ai[1]/pitch-deg">
			<function>
				<product>
					<property>/instrumentation/ai[1]/power</property>
					<property>/orientation/pitch-deg</property>
				</product>
			</function>
			<clipto>
				<min>-90</min>
				<max>90</max>
			</clipto>
		</fcs_function>
		
		<fcs_function name="/instrumentation/ai[1]/roll-deg">
			<function>
				<product>
					<property>/instrumentation/ai[1]/power</property>
					<property>/orientation/roll-deg</property>
				</product>
			</function>
			<clipto>
				<min>-180</min>
				<max>180</max>
			</clipto>
		</fcs_function>
		
		<switch name="/instrumentation/ai[1]/loc-deviation-cmd">
			<default value="0"/>
			<test logic="AND" value="/instrumentation/nav[1]/heading-needle-deflection">
				/instrumentation/ai[1]/power-avail eq 1
				/systems/electrical/outputs/nav[1] ge 24
				/instrumentation/nav[1]/in-range eq 1
				/instrumentation/nav[1]/signal-quality-norm gt 0.99
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/ai[1]/loc-deviation">
			<input>/instrumentation/ai[1]/loc-deviation-cmd</input>
			<c1>10</c1>
		</lag_filter>
		
		<switch name="/instrumentation/ai[1]/gs-deviation-cmd">
			<default value="0"/>
			<test logic="AND" value="/instrumentation/nav[1]/gs-needle-deflection">
				/instrumentation/ai[1]/power-avail eq 1
				/systems/electrical/outputs/nav[1] ge 24
				/instrumentation/nav[1]/gs-in-range eq 1
				/instrumentation/nav[1]/has-gs eq 1
				/instrumentation/nav[1]/signal-quality-norm gt 0.99
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/ai[1]/gs-deviation">
			<input>/instrumentation/ai[1]/gs-deviation-cmd</input>
			<c1>10</c1>
		</lag_filter>
		
		<pure_gain name="/instrumentation/ai[1]/slip-skid-Ny">
			<input>accelerations/Ny</input>
			<gain>-25</gain>
		</pure_gain>
		
		<switch name="/instrumentation/ai[1]/slip-skid-cmd">
			<default value="/fdm/jsbsim/aero/beta-deg"/>
			<test value="0">
				/instrumentation/ai[1]/power-avail ne 1
			</test>
			<test value="/instrumentation/ai[1]/slip-skid-Ny">
				position/wow eq 1
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/ai[1]/slip-skid">
			<input>/instrumentation/ai[1]/slip-skid-cmd</input>
			<c1>5.0</c1>
		</lag_filter>
		
		<!-- Standby Attitude Indicator -->
		<switch name="/instrumentation/stby-ai/spin-cmd">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/dc-trans ge 24
			</test>
		</switch>
		
		<actuator name="/instrumentation/stby-ai/spin-pos">
			<input>/instrumentation/stby-ai/spin-cmd</input>
			<rate_limit sense="incr">0.2</rate_limit>
			<rate_limit sense="decr">0.04</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/stby-ai/spin">
			<input>/instrumentation/stby-ai/spin-pos</input>
			<c1>1</c1>
		</lag_filter>
		
		<fcs_function name="/instrumentation/stby-ai/pitch-deg">
			<function>
				<sum>
					<value>20</value>
					<product>
						<property>/instrumentation/stby-ai/spin</property>
						<difference>
							<property>/orientation/pitch-deg</property>
							<value>20</value>
						</difference>
					</product>
				</sum>
			</function>
			<clipto>
				<min>-90</min>
				<max>90</max>
			</clipto>
		</fcs_function>
		
		<fcs_function name="/instrumentation/stby-ai/roll-deg">
			<function>
				<sum>
					<value>40</value>
					<product>
						<property>/instrumentation/stby-ai/spin</property>
						<difference>
							<property>/orientation/roll-deg</property>
							<value>40</value>
						</difference>
					</product>
				</sum>
			</function>
			<clipto>
				<min>-180</min>
				<max>180</max>
			</clipto>
		</fcs_function>
	
	</channel>
	
	<channel name="Altimeters" execrate="2">
		
		<!-- Altimeter 1 -->
		<switch name="/instrumentation/altimeter[0]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/emer-ac ge 112
			</test>
		</switch>
		
		<switch name="/instrumentation/altimeter[0]/altitude-ft-input">
			<default value="/instrumentation/altimeter[0]/altitude-ft-input"/>
			<test value="/instrumentation/altimeter[0]/indicated-altitude-ft">
				/instrumentation/altimeter[0]/power-avail eq 1
			</test>
		</switch>
		
		<actuator name="/instrumentation/altimeter[0]/altitude-ft-actuator">
			<input>/instrumentation/altimeter[0]/altitude-ft-input</input>
			<rate_limit>1500</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/altimeter[0]/altitude-ft">
			<input>/instrumentation/altimeter[0]/altitude-ft-actuator</input>
			<c1>15</c1>
		</lag_filter>
		
		<!-- Altimeter 2 -->
		<switch name="/instrumentation/altimeter[1]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/ac-r ge 112
			</test>
		</switch>
		
		<switch name="/instrumentation/altimeter[1]/altitude-ft-input">
			<default value="/instrumentation/altimeter[1]/altitude-ft-input"/>
			<test value="/instrumentation/altimeter[0]/indicated-altitude-ft"> <!-- Fix me when they are seperate -->
				/instrumentation/altimeter[1]/power-avail eq 1
			</test>
		</switch>
		
		<actuator name="/instrumentation/altimeter[1]/altitude-ft-actuator">
			<input>/instrumentation/altimeter[1]/altitude-ft-input</input>
			<rate_limit>1500</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/altimeter[1]/altitude-ft">
			<input>/instrumentation/altimeter[1]/altitude-ft-actuator</input>
			<c1>15</c1>
		</lag_filter>
		
		<!-- Altimeter Standby -->
		<switch name="/instrumentation/altimeter[2]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/dc-trans ge 24
			</test>
		</switch>
		
		<switch name="/instrumentation/altimeter[2]/altitude-ft-input">
			<default value="/instrumentation/altimeter[2]/altitude-ft-input"/>
			<test value="/instrumentation/altimeter[0]/indicated-altitude-ft"> <!-- Fix me when they are seperate -->
				/instrumentation/altimeter[2]/power-avail eq 1
			</test>
		</switch>
		
		<actuator name="/instrumentation/altimeter[2]/altitude-ft-actuator">
			<input>/instrumentation/altimeter[2]/altitude-ft-input</input>
			<rate_limit>1500</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/altimeter[2]/altitude-ft">
			<input>/instrumentation/altimeter[2]/altitude-ft-actuator</input>
			<c1>15</c1>
		</lag_filter>
	
	</channel>
	
	<channel name="Radio Magnetic Indicators" execrate="2">
		
		<!-- Radio Magnetic Indicator 1 -->
		<switch name="/instrumentation/rmi[0]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/ac-r ge 112
			</test>
		</switch>
		
		<switch name="/instrumentation/rmi[0]/heading-input">
			<default value="/instrumentation/rmi[0]/heading-input"/>
			<test value="/orientation/heading-magnetic-deg">
				/instrumentation/rmi[0]/power-avail eq 1
			</test>
			<output>/instrumentation/rmi[0]/heading-linear</output>
		</switch>
		
		<!--linear_actuator name="/instrumentation/rmi[0]/heading-linear-cmd">
			<input>/instrumentation/rmi[0]/heading-input</input>
			<module>360</module>
		</linear_actuator>
		
		<actuator name="/instrumentation/rmi[0]/heading-linear-actuator">
			<input>/instrumentation/rmi[0]/heading-linear-cmd</input>
			<rate_limit>90</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/rmi[0]/heading-linear">
			<input>/instrumentation/rmi[0]/heading-linear-actuator</input>
			<c1>10</c1>
		</lag_filter-->
		
		<!-- TODO: Figure out how to use linear actuator from -180 to 180 -->
		<switch name="/instrumentation/rmi[0]/nav1-input">
			<default value="0"/>
			<test logic="AND" value="/instrumentation/rmi[0]/nav1-error">
				/instrumentation/rmi[0]/power-avail eq 1
				/instrumentation/rmi[0]/vor-adf-1 eq 1
			</test>
			<test value="/instrumentation/rmi[0]/adf1-error">
				/instrumentation/rmi[0]/power-avail eq 1
			</test>
			<output>/instrumentation/rmi[0]/nav1-linear</output>
		</switch>
		
		<switch name="/instrumentation/rmi[0]/nav2-input">
			<default value="0"/>
			<test logic="AND" value="/instrumentation/rmi[0]/nav2-error">
				/instrumentation/rmi[0]/power-avail eq 1
				/instrumentation/rmi[0]/vor-adf-2 eq 1
			</test>
			<test value="/instrumentation/rmi[0]/adf2-error">
				/instrumentation/rmi[0]/power-avail eq 1
			</test>
			<output>/instrumentation/rmi[0]/nav2-linear</output>
		</switch>
		
		<!-- Radio Magnetic Indicator 2 -->
		<switch name="/instrumentation/rmi[1]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/emer-ac ge 112
			</test>
		</switch>
		
		<switch name="/instrumentation/rmi[1]/heading-input">
			<default value="/instrumentation/rmi[1]/heading-input"/>
			<test value="/orientation/heading-magnetic-deg">
				/instrumentation/rmi[1]/power-avail eq 1
			</test>
			<output>/instrumentation/rmi[1]/heading-linear</output>
		</switch>
		
		<!--linear_actuator name="/instrumentation/rmi[1]/heading-linear-cmd">
			<input>/instrumentation/rmi[1]/heading-input</input>
			<module>360</module>
		</linear_actuator>
		
		<actuator name="/instrumentation/rmi[1]/heading-linear-actuator">
			<input>/instrumentation/rmi[1]/heading-linear-cmd</input>
			<rate_limit>90</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/rmi[1]/heading-linear">
			<input>/instrumentation/rmi[1]/heading-linear-actuator</input>
			<c1>10</c1>
		</lag_filter-->
		
		<!-- TODO: Figure out how to use linear actuator from -180 to 180 -->
		<switch name="/instrumentation/rmi[1]/nav1-input">
			<default value="0"/>
			<test logic="AND" value="/instrumentation/rmi[1]/nav1-error">
				/instrumentation/rmi[1]/power-avail eq 1
				/instrumentation/rmi[1]/vor-adf-1 eq 1
			</test>
			<test value="/instrumentation/rmi[1]/adf1-error">
				/instrumentation/rmi[1]/power-avail eq 1
			</test>
			<output>/instrumentation/rmi[1]/nav1-linear</output>
		</switch>
		
		<switch name="/instrumentation/rmi[1]/nav2-input">
			<default value="0"/>
			<test logic="AND" value="/instrumentation/rmi[1]/nav2-error">
				/instrumentation/rmi[1]/power-avail eq 1
				/instrumentation/rmi[1]/vor-adf-2 eq 1
			</test>
			<test value="/instrumentation/rmi[1]/adf2-error">
				/instrumentation/rmi[1]/power-avail eq 1
			</test>
			<output>/instrumentation/rmi[1]/nav2-linear</output>
		</switch>
	
	</channel>
	
	<channel name="Horizontal Situation Indicators" execrate="2">
		
		<!-- Horizontal Situation Indicator 1 -->
		<switch name="/instrumentation/hsi[0]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/emer-ac ge 112
			</test>
		</switch>
		
		<switch name="/instrumentation/hsi[0]/heading-input">
			<default value="/instrumentation/hsi[0]/heading-input"/>
			<test value="/orientation/heading-magnetic-deg">
				/instrumentation/hsi[0]/power-avail eq 1
			</test>
			<output>/instrumentation/hsi[0]/heading-linear</output>
		</switch>
		
		<!--linear_actuator name="/instrumentation/hsi[0]/heading-linear-cmd">
			<input>/instrumentation/hsi[0]/heading-input</input>
			<module>360</module>
		</linear_actuator>
		
		<actuator name="/instrumentation/hsi[0]/heading-linear-actuator">
			<input>/instrumentation/hsi[0]/heading-linear-cmd</input>
			<rate_limit>90</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/hsi[0]/heading-linear">
			<input>/instrumentation/hsi[0]/heading-linear-actuator</input>
			<c1>10</c1>
		</lag_filter-->
		
		<switch name="/instrumentation/hsi[0]/heading-bug-input">
			<default value="/instrumentation/hsi[0]/heading-bug-input"/>
			<test value="/it-autoflight/input/hdg">
				/instrumentation/hsi[0]/power-avail eq 1
			</test>
			<output>/instrumentation/hsi[0]/heading-bug-linear</output>
		</switch>
		
		<!--linear_actuator name="/instrumentation/hsi[0]/heading-bug-linear-cmd">
			<input>/instrumentation/hsi[0]/heading-bug-input</input>
			<module>360</module>
		</linear_actuator>
		
		<lag_filter name="/instrumentation/hsi[0]/heading-bug-linear">
			<input>/instrumentation/hsi[0]/heading-bug-linear-cmd</input>
			<c1>20</c1>
		</lag_filter-->
		
		<switch name="/instrumentation/hsi[0]/course-input">
			<default value="/instrumentation/hsi[0]/course-input"/>
			<test logic="AND" value="/instrumentation/nav[2]/radials/selected-deg">
				/instrumentation/hsi[0]/power-avail eq 1
				/instrumentation/hsi[0]/slaved-to-gps eq 1
			</test>
			<test value="/instrumentation/nav[0]/radials/selected-deg">
				/instrumentation/hsi[0]/power-avail eq 1
			</test>
			<output>/instrumentation/hsi[0]/course-linear</output>
		</switch>
		
		<!--linear_actuator name="/instrumentation/hsi[0]/course-linear-cmd">
			<input>/instrumentation/hsi[0]/course-input</input>
			<module>360</module>
		</linear_actuator>
		
		<lag_filter name="/instrumentation/hsi[0]/course-linear">
			<input>/instrumentation/hsi[0]/course-linear-cmd</input>
			<c1>20</c1>
		</lag_filter-->
		
		<switch name="/instrumentation/hsi[0]/loc-deviation-cmd">
			<default value="0"/>
			<test logic="AND" value="/instrumentation/nav[2]/heading-needle-deflection">
				/instrumentation/hsi[0]/power-avail eq 1
				/instrumentation/hsi[0]/slaved-to-gps eq 1
			</test>
			<test value="/instrumentation/nav[0]/heading-needle-deflection">
				/instrumentation/hsi[0]/power-avail eq 1
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/hsi[0]/loc-deviation">
			<input>/instrumentation/hsi[0]/loc-deviation-cmd</input>
			<c1>10</c1>
		</lag_filter>
		
		<switch name="/instrumentation/hsi[0]/gs-deviation-cmd">
			<default value="0"/>
			<test logic="AND" value="0">
				/instrumentation/hsi[0]/power-avail eq 1
				/instrumentation/hsi[0]/slaved-to-gps eq 1
			</test>
			<test value="/instrumentation/nav[0]/gs-needle-deflection">
				/instrumentation/hsi[0]/power-avail eq 1
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/hsi[0]/gs-deviation">
			<input>/instrumentation/hsi[0]/gs-deviation-cmd</input>
			<c1>10</c1>
		</lag_filter>
		
		<!-- Horizontal Situation Indicator 2 -->
		<switch name="/instrumentation/hsi[1]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/ac-r ge 112
			</test>
		</switch>
		
		<switch name="/instrumentation/hsi[1]/heading-input">
			<default value="/instrumentation/hsi[1]/heading-input"/>
			<test value="/orientation/heading-magnetic-deg">
				/instrumentation/hsi[1]/power-avail eq 1
			</test>
			<output>/instrumentation/hsi[1]/heading-linear</output>
		</switch>
		
		<!--linear_actuator name="/instrumentation/hsi[1]/heading-linear-cmd">
			<input>/instrumentation/hsi[1]/heading-input</input>
			<module>360</module>
		</linear_actuator>
		
		<actuator name="/instrumentation/hsi[1]/heading-linear-actuator">
			<input>/instrumentation/hsi[1]/heading-linear-cmd</input>
			<rate_limit>90</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/hsi[1]/heading-linear">
			<input>/instrumentation/hsi[1]/heading-linear-actuator</input>
			<c1>10</c1>
		</lag_filter-->
		
		<switch name="/instrumentation/hsi[1]/heading-bug-input">
			<default value="/instrumentation/hsi[1]/heading-bug-input"/>
			<test value="/it-autoflight/input/hdg">
				/instrumentation/hsi[1]/power-avail eq 1
			</test>
			<output>/instrumentation/hsi[1]/heading-bug-linear</output>
		</switch>
		
		<!--linear_actuator name="/instrumentation/hsi[1]/heading-bug-linear-cmd">
			<input>/instrumentation/hsi[1]/heading-bug-input</input>
			<module>360</module>
		</linear_actuator>
		
		<lag_filter name="/instrumentation/hsi[1]/heading-bug-linear">
			<input>/instrumentation/hsi[1]/heading-bug-linear-cmd</input>
			<c1>20</c1>
		</lag_filter-->
		
		<switch name="/instrumentation/hsi[1]/course-input">
			<default value="/instrumentation/hsi[1]/course-input"/>
			<test logic="AND" value="/instrumentation/nav[2]/radials/selected-deg">
				/instrumentation/hsi[1]/power-avail eq 1
				/instrumentation/hsi[1]/slaved-to-gps eq 1
			</test>
			<test value="/instrumentation/nav[1]/radials/selected-deg">
				/instrumentation/hsi[1]/power-avail eq 1
			</test>
			<output>/instrumentation/hsi[1]/course-linear</output>
		</switch>
		
		<!--linear_actuator name="/instrumentation/hsi[1]/course-linear-cmd">
			<input>/instrumentation/hsi[1]/course-input</input>
			<module>360</module>
		</linear_actuator>
		
		<lag_filter name="/instrumentation/hsi[1]/course-linear">
			<input>/instrumentation/hsi[1]/course-linear-cmd</input>
			<c1>20</c1>
		</lag_filter-->
		
		<switch name="/instrumentation/hsi[1]/loc-deviation-cmd">
			<default value="0"/>
			<test logic="AND" value="/instrumentation/nav[2]/heading-needle-deflection">
				/instrumentation/hsi[1]/power-avail eq 1
				/instrumentation/hsi[1]/slaved-to-gps eq 1
			</test>
			<test value="/instrumentation/nav[1]/heading-needle-deflection">
				/instrumentation/hsi[1]/power-avail eq 1
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/hsi[1]/loc-deviation">
			<input>/instrumentation/hsi[1]/loc-deviation-cmd</input>
			<c1>10</c1>
		</lag_filter>
		
		<switch name="/instrumentation/hsi[1]/gs-deviation-cmd">
			<default value="0"/>
			<test logic="AND" value="0">
				/instrumentation/hsi[1]/power-avail eq 1
				/instrumentation/hsi[1]/slaved-to-gps eq 1
			</test>
			<test value="/instrumentation/nav[1]/gs-needle-deflection">
				/instrumentation/hsi[1]/power-avail eq 1
			</test>
		</switch>
		
		<lag_filter name="/instrumentation/hsi[1]/gs-deviation">
			<input>/instrumentation/hsi[1]/gs-deviation-cmd</input>
			<c1>10</c1>
		</lag_filter>
	
	</channel>
	
	<channel name="Vertical Speed Indicators" execrate="2">
		
		<!-- Vertical Speed Indicator 1 -->
		<switch name="/instrumentation/vertical-speed-indicator[0]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/emer-ac ge 112
			</test>
		</switch>
		
		<switch name="/instrumentation/vertical-speed-indicator[0]/vs-fpm-input">
			<default value="/instrumentation/vertical-speed-indicator[0]/vs-fpm-input"/>
			<test value="/instrumentation/vertical-speed-indicator/vert-speed-fpm">
				/instrumentation/vertical-speed-indicator[0]/power-avail eq 1
			</test>
		</switch>
		
		<actuator name="/instrumentation/vertical-speed-indicator[0]/vs-fpm-actuator">
			<input>/instrumentation/vertical-speed-indicator[0]/vs-fpm-input</input>
			<rate_limit>1500</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/vertical-speed-indicator[0]/vs-fpm">
			<input>/instrumentation/vertical-speed-indicator[0]/vs-fpm-actuator</input>
			<c1>15</c1>
		</lag_filter>
		
		<!-- Vertical Speed Indicator 2 -->
		<switch name="/instrumentation/vertical-speed-indicator[1]/power-avail">
			<default value="0"/>
			<test value="1">
				/systems/electrical/bus/ac-r ge 112
			</test>
		</switch>
		
		<switch name="/instrumentation/vertical-speed-indicator[1]/vs-fpm-input">
			<default value="/instrumentation/vertical-speed-indicator[1]/vs-fpm-input"/>
			<test value="/instrumentation/vertical-speed-indicator/vert-speed-fpm">
				/instrumentation/vertical-speed-indicator[1]/power-avail eq 1
			</test>
		</switch>
		
		<actuator name="/instrumentation/vertical-speed-indicator[1]/vs-fpm-actuator">
			<input>/instrumentation/vertical-speed-indicator[1]/vs-fpm-input</input>
			<rate_limit>1500</rate_limit>
		</actuator>
		
		<lag_filter name="/instrumentation/vertical-speed-indicator[1]/vs-fpm">
			<input>/instrumentation/vertical-speed-indicator[1]/vs-fpm-actuator</input>
			<c1>15</c1>
		</lag_filter>
	
	</channel>
	
	<channel name="Misc Gauges" execrate="4">
		
		<!-- EPR Gauges -->
		<fcs_function name="engine/gauge/epr-actual-1-fixed">
			<function>
				<sum>
					<property>engine/epr-actual-1</property>
					<value>0.003</value>
				</sum>
			</function>
		</fcs_function>
		
		<fcs_function name="engine/gauge/epr-actual-1-d100">
			<function>
				<integer>
					<property>engine/gauge/epr-actual-1-fixed</property>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="engine/gauge/epr-actual-1-d10">
			<function>
				<integer>
					<product>
						<difference>
							<property>engine/gauge/epr-actual-1-fixed</property>
							<integer>
								<property>engine/gauge/epr-actual-1-fixed</property>
							</integer>
						</difference>
						<value>10</value>
					</product>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="engine/gauge/epr-actual-1-d1">
			<function>
				<product>
					<fraction>
						<product>
							<property>engine/epr-actual-1</property> <!-- Not epr-fixed on purpose! -->
							<value>10</value>
						</product>
					</fraction>
					<value>10</value>
				</product>
			</function>
		</fcs_function>
		
		<fcs_function name="engine/gauge/epr-actual-2-fixed">
			<function>
				<sum>
					<property>engine/epr-actual-2</property>
					<value>0.003</value>
				</sum>
			</function>
		</fcs_function>
		
		<fcs_function name="engine/gauge/epr-actual-2-d100">
			<function>
				<integer>
					<property>engine/gauge/epr-actual-2-fixed</property>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="engine/gauge/epr-actual-2-d10">
			<function>
				<integer>
					<product>
						<difference>
							<property>engine/gauge/epr-actual-2-fixed</property>
							<integer>
								<property>engine/gauge/epr-actual-2-fixed</property>
							</integer>
						</difference>
						<value>10</value>
					</product>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="engine/gauge/epr-actual-2-d1">
			<function>
				<product>
					<fraction>
						<product>
							<property>engine/epr-actual-2</property> <!-- Not epr-fixed on purpose! -->
							<value>10</value>
						</product>
					</fraction>
					<value>10</value>
				</product>
			</function>
		</fcs_function>
	
	</channel>
	
	<channel name="TRI and FLEX" execrate="4">
		
		<switch name="/controls/tri/rat">
			<default value="/controls/tri/rat"/>
			<test value="propulsion/tat-c">
				dfgs/power-avail eq 1
			</test>
		</switch>
		
		<!-- TRI -->
		<fcs_function name="/controls/tri/rat-fixed">
			<function>
				<sum>
					<abs>
						<property>/controls/tri/rat</property>
					</abs>
					<value>0.5</value> <!-- Make it round correctly -->
				</sum>
			</function>
		</fcs_function>
		
		<fcs_function name="/controls/tri/rat-d10">
			<function>
				<integer>
					<quotient>
						<property>/controls/tri/rat-fixed</property>
						<value>10</value>
					</quotient>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="/controls/tri/rat-d1">
			<function>
				<integer>
					<product>
						<fraction>
							<quotient>
								<property>/controls/tri/rat-fixed</property>
								<value>10</value>
							</quotient>
						</fraction>
						<value>10</value>
					</product>
				</integer>
			</function>
		</fcs_function>
		
		<switch name="/controls/tri/limit-active">
			<default value="/controls/tri/limit-active"/>
			<test value="engine/limit/active-ind">
				dfgs/power-avail eq 1
			</test>
		</switch>
		
		<fcs_function name="/controls/tri/limit-fixed">
			<function>
				<sum>
					<property>/controls/tri/limit-active</property>
					<value>0.005</value> <!-- Make it round correctly -->
				</sum>
			</function>
		</fcs_function>
		
		<fcs_function name="/controls/tri/limit-d100">
			<function>
				<integer>
					<property>/controls/tri/limit-fixed</property>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="/controls/tri/limit-d10">
			<function>
				<integer>
					<product>
						<difference>
							<property>/controls/tri/limit-fixed</property>
							<integer>
								<property>/controls/tri/limit-fixed</property>
							</integer>
						</difference>
						<value>10</value>
					</product>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="/controls/tri/limit-d1">
			<function>
				<integer>
					<product>
						<fraction>
							<product>
								<property>/controls/tri/limit-fixed</property>
								<value>10</value>
							</product>
						</fraction>
						<value>10</value>
					</product>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="/controls/tri/flex-fixed">
			<function>
				<sum>
					<abs>
						<property>engine/limit/flex-temp</property>
					</abs>
					<value>0.5</value> <!-- Make it round correctly -->
				</sum>
			</function>
		</fcs_function>
		
		<fcs_function name="/controls/tri/flex-d10">
			<function>
				<integer>
					<quotient>
						<property>/controls/tri/flex-fixed</property>
						<value>10</value>
					</quotient>
				</integer>
			</function>
		</fcs_function>
		
		<fcs_function name="/controls/tri/flex-d1">
			<function>
				<integer>
					<product>
						<fraction>
							<quotient>
								<property>/controls/tri/flex-fixed</property>
								<value>10</value>
							</quotient>
						</fraction>
						<value>10</value>
					</product>
				</integer>
			</function>
		</fcs_function>
	
	</channel>
	
	<channel name="Cockpit Indications" execrate="8">
		
		<fcs_function name="inertia/weight-lbs-fmt">
			<function>
				<product>
					<integer>
						<sum>
							<quotient>
								<property>inertia/weight-lbs</property>
								<value>25</value>
							</quotient>
							<value>0.5</value>
						</sum>
					</integer>
					<value>25</value>
				</product>
			</function>
		</fcs_function>
		
		<switch name="/controls/flight/slat-indicator">
			<default value="2"/> <!-- Disag -->
			<test logic="AND" value="4"> <!-- Land -->
				fcs/slat-pos-deg ge 19.9
				/controls/flight/flaps-input gt 3
			</test>
			<test logic="AND" value="1"> <!-- Takeoff -->
				fcs/slat-pos-deg ge 9.9
				fcs/slat-pos-deg le 10.1
				/controls/flight/slats-cmd eq 10
			</test>
			<test logic="AND" value="1"> <!-- Takeoff -->
				fcs/slat-pos-deg ge 19.9
				/controls/flight/slats-cmd eq 20
			</test>
			<test logic="AND" value="0"> <!-- Off -->
				fcs/slat-pos-deg lt 0.1
				/controls/flight/flaps-input eq 0
			</test>
		</switch>
	
	</channel>

</system>
